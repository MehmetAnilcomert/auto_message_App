<!DOCTYPE html>
<html>
<head>
  <title>WhatsApp QR Kod</title>
  <meta charset="UTF-8">
  <style>
    body { font-family: Arial, sans-serif; text-align: center; padding: 50px; background: #f5f5f5; }
    .container { background: white; padding: 30px; border-radius: 10px; box-shadow: 0 2px 10px rgba(0,0,0,0.1); display: inline-block; }
    img { border: 5px solid #25D366; border-radius: 10px; margin: 20px 0; }
    .status { padding: 10px; border-radius: 5px; margin: 20px 0; font-weight: bold; }
    .pending { background: #fff3cd; color: #856404; }
    .ready { background: #d4edda; color: #155724; }
    .failed { background: #f8d7da; color: #721c24; }
    button { background: #25D366; color: white; border: none; padding: 10px 20px; border-radius: 5px; cursor: pointer; font-size: 16px; margin: 10px; }
    button:hover { background: #128C7E; }
  </style>
</head>
<body>
  <div class="container">
    <h1>📱 WhatsApp Bağlantısı</h1>
    <div id="status" class="status pending">Durum: Yükleniyor...</div>
    <div id="qr-container"></div>
    <button onclick="location.reload()">🔄 Yenile</button>
    <button onclick="refreshAuth()">🔄 Yeni QR Kod</button>
  </div>

  <script>
    const statusTexts = {
      'pending': '⏳ Başlatılıyor...',
      'qr_generated': '📱 QR kodu oluşturuldu, lütfen tarayın',
      'authenticating': '🔐 Kimlik doğrulanıyor...',
      'ready': '✅ Hazır!',
      'failed': '❌ Bağlantı başarısız'
    };

    function getStatusText(status) {
      return statusTexts[status] || status;
    }

    async function fetchStatus() {
      const res = await fetch('/whatsapp-status');
      const data = await res.json();

      const statusDiv = document.getElementById('status');
      statusDiv.className = 'status ' + (data.ready ? 'ready' : 'pending');
      statusDiv.innerText = 'Durum: ' + getStatusText(data.authStatus);

      const qrContainer = document.getElementById('qr-container');
      if (data.qrCodeImagePath) {
        qrContainer.innerHTML = `
          <img src="${data.qrCodeImagePath}" alt="QR Code" />
          <p><small>QR kod 30 saniye sonra yenilenecek</small></p>
        `;
      }
    }

    setInterval(fetchStatus, 5000);
    fetchStatus();

    function refreshAuth() {
      fetch('/refresh-auth', { method: 'POST' }).then(() => {
        setTimeout(() => location.reload(), 3000);
      });
    }
  </script>
</body>
</html>
